<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>hello world10</h1>
    <div id="categories">
    </div>
    <div id="flashcards"></div>
    <script type="text/javascript">
        var root = window.location.hostname === 'localhost' ?
            '.' :
            'https://raw.githubusercontent.com/reidjs/flashcards/master'
        function readTextFile(file, callback) {
            const rawFile = new XMLHttpRequest();
            rawFile.open("GET", file, false);
            rawFile.onreadystatechange = function () {
                if(rawFile.readyState === 4) {
                    if(rawFile.status === 200 || rawFile.status == 0) {
                        const allText = rawFile.responseText;
                        callback(allText)
                    }
                }
            }
            rawFile.send(null);
        }
        function loadXMLDoc(url) {
            let xmlhttp
            if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari, SeaMonkey
                xmlhttp=new XMLHttpRequest();
            }
            else {// code for IE6, IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    const text = xmlhttp.responseText   
                    const div = document.createElement('div')
                    div.innerHTML = text
                    const ul = div.getElementsByTagName('ul')
                    console.log(ul[0])
                    const categories = document.getElementById('categories')
                    categories.appendChild(ul[0])
                    const anchors = document.getElementsByTagName('a')
                    for(let i = 0; i < anchors.length; i++) {
                        const anchor = anchors[i]
                        anchor.setAttribute('href', `#${anchor.innerHTML}`)
                    }
                }
            }
            xmlhttp.open("GET", url, false);
            xmlhttp.send();
        }
        let categorySelected;
        const getLocationHash = () => {
            const hash = window.location.hash
            return hash.slice(1)
        }
        const renderFlashcards = (markdown) => {
            console.log(markdown)
            // all lines that start with #
            const questionRegex = /#+.*/gm
            // all lines that are between lines that start with #
            const answerRegex = /(?<=#+.*\n)((.|\n)*?)(?=(#|^$))/gm
            const questions = markdown.match(questionRegex)
            const answers = markdown.match(answerRegex)
            console.log('q', questions)
            console.log('a', answers)
            if (questions.length !== answers.length) {
                console.error('Questions and answers do not match!')
            }
        }
        const loadFileAndRender = () => {
            readTextFile(`${path}/categories/${getLocationHash()}`, renderFlashcards)
        }
        document.addEventListener('DOMContentLoaded', () => {
            console.log(categories)
            loadXMLDoc('./categories')
            window.onhashchange = function(e) { 
                loadFileAndRender()
            }
            loadFileAndRender()
        })
        fetch('https://github.com/login/oauth/authorize').then(res => {
            console.log(res)
        })
    </script>
</body>
</html>